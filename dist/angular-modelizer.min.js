"use strict";!function(e,t){"function"==typeof define&&define.amd?define(["angular","lodash"],function(e,r){return t(e,r,document)}):t(angular,_,document)}(window,function(e,t,r,i){var s,n=function(e){throw new Error(e)},o=function(t){return t=t||{},e.forEach(arguments,function(e){if(e!==t)for(var r in e){var s=Object.getOwnPropertyDescriptor(e,r);if(s&&(s.get||s.set)){var n=s.get||i,o=s.set||i;Object.defineProperty(t,r,{get:n,set:o,enumerable:!0,configurable:!0})}else t[r]=e[r]}}),t},l={isLikeUrl:function(e){return t.contains(e,"/")||t.contains(e,"-")},asUrl:function(e){return e?l.stripDoubleSlashes("/"+e):""},combineUrls:function(){var e=t.filter(Array.prototype.slice.call(arguments),function(e){return!!e});return l.asUrl(e.join("/"))},stripDoubleSlashes:function(e){return e?e.replace(/(\/)\/+/g,"$1"):""},trimSlashes:function(e){return e.replace(/^\/|\/$/g,"")},stripOverlap:function(e,t){if(!e||!t)return e;var r=l.trimSlashes(e).split("/"),i=l.trimSlashes(t).split("/"),s=[],n=!1;for(r.length>i.length?r.splice(0,r.length-i.length):i.length=r.length;r.length;){for(var o=0;o<r.length;o++){if(r[o]!==i[o]){s=[],n=!1;break}n=!0,s.push(r[o])}if(n)break;r.shift(),i.pop()}var a=l.asUrl(s.join("/"));return l.asUrl(a.length?e.substring(0,e.indexOf(a)):e)},setUrlParams:function(e,t,r){return e?e.replace(/\:\_*[A-Za-z]+/g,function(s){return s=s.replace(/\:*/,""),t[s]!==i||r||n('No parameter "'+s+'" is available for URL '+e),t[s]}):e},appendIdParam:function(e,t,r){return e?e.replace(/([^\/])$/,"$1/")+(r?t:":"+(t||"id")):e},buildRestfulUrl:function(e,t,r){return t?l.asUrl(e):l.asUrl(l.appendIdParam(e,r,!0))}},a={capitalize:function(e){return e?e.charAt(0).toUpperCase()+e.slice(1):e},pluralize:function(e){return e?"s"===e.charAt(e.length)?e+"es":e+"s":e},toDashCase:function(e){return e?e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase():e}},d={byModelName:{},byCollectionName:{},byBaseUrl:{},addModelClass:function(e){if(e&&e._modelClassMeta){var t=e._modelClassMeta;t.modelName&&(this.byModelName[t.modelName]=e),t.collectionName&&(this.byCollectionName[t.collectionName]=e),e.baseUrl&&"/"!==e&&!this.byBaseUrl[e.baseUrl]&&(this.byBaseUrl[e.baseUrl]=e)}}},u={model:function(e){var r=e.modelClass,i=t.omit(e,"modelClass"),n=!r||t.isString(r),o=function(o,l){var a,u=null;r&&n?a=d.byModelName[r]||d.byModelName[l]:r&&(a=r),a||(a=s),e.modelClass=a,Object.defineProperty(o,l,{enumerable:!0,configurable:!0,get:function(){return u},set:function(e){return e?(e instanceof a?u=e:t.isObject(e)&&(u=a.$new(e,i)),void 0):(u=e,void 0)}})};return e.attrType="model",o.attrDefinition=e,o.isPropertyInitializer=!0,o},collection:function(e){var r=e.modelClass,i=t.omit(e,"modelClass"),n=!r||t.isString(r),o=function(t,o){var l,a=null;r&&n?l=d.byModelName[r]||d.byModelName[o]:r&&(l=r),l||(l=s),e.modelClass=l,Object.defineProperty(t,o,{enumerable:!0,configurable:!0,get:function(){return a||(a=l.$newCollection(null,i)),a},set:function(e){a?a.reset(e):a=l.$newCollection(e,i)}})};return e.attrType="collection",o.attrDefinition=e,o.isPropertyInitializer=!0,o},date:function(e){var r=function(e,r){var i=null;Object.defineProperty(e,r,{enumerable:!0,configurable:!0,get:function(){return i||(i=new Date(0)),i},set:function(e){e instanceof Date?i=e:(t.isString(e)||t.isNumber(e))&&(i=Date(e))}})};return e.attrType="date",r.attrDefinition=e,r.isPropertyInitializer=!0,r},computed:function(e){var t=function(t,r){Object.defineProperty(t,r,{enumerable:!0,configurable:!0,get:function(){return e(this)}})};return t.attrDefinition={attrType:"computed"},t.isPropertyInitializer=!0,t}},c={isModelClass:function(e){return e.prototype instanceof s},isDefaultModelClass:function(e){return e===s},hasSpecialAttr:function(e,t){return e&&e._modelClassMeta&&e._modelClassMeta.propertyInitializers?!!e._modelClassMeta.propertyInitializers[t]:!1},hasCollectionAttr:function(e,t){var r=this.getSpecialAttrMeta(e,t);return r&&"collection"===r.attrType},hasModelAttr:function(e,t){var r=this.getSpecialAttrMeta(e,t);return r&&"model"===r.attrType},getSpecialAttrMeta:function(e,t){return this.hasSpecialAttr(e,t)?e._modelClassMeta.propertyInitializers[t].attrDefinition:null},extendClass:function(e,r,i,s){var n;return s=s||"Extended",n=r&&t.has(r,"constructor")?r.constructor:new Function("p","return function "+s+"(){return p.apply(this,arguments);}")(e),o(n,e,i),n.prototype=Object.create(e.prototype),r&&o(n.prototype,r),n.superclass=n.prototype._superclass=e,n.__super__=n.prototype._super=e.prototype,n.prototype._class=n,n},extendModelClass:function(e,r,s){r=r||{};var l,u,c,h=t.omit(r,"static","collection","baseUrl","urlPrefix"),f={},m=t.isObject(r.collection)?r.collection:null,p=t.isObject(r.static)?r.static:{},v={},b={};t.isArray(s)&&s.length>0?(l=s[0],u=s[1]):t.isString(s)&&(l=s),t.isString(l)||n("You have to provide the model name to define a new model"),d.byModelName[l]&&n('The model name should be unique. It seems that you already have the model with name "'+l+'"'),l&&!u&&(u=a.pluralize(l)),d.byCollectionName[u]&&n('The collection name should be unique. It seems that you already have the model with collection name "'+u+'"'),c=l?a.capitalize(l):"ExtendedModel";for(var g in h)if(t.isFunction(h[g]))h[g].isPropertyInitializer&&(v[g]=h[g],delete h[g]);else{var C=Object.getOwnPropertyDescriptor(h,g);if(C.get||C.set)continue;f[g]=h[g],delete h[g]}var y=o({},h);p.urlPrefix=r.urlPrefix||i,p.baseUrl=r.baseUrl||i,p.baseUrl||(p.baseUrl=a.toDashCase(u));var _=this.extendClass(e,y,p,c);return b={modelDefinition:r,modelName:l,collectionName:u,superclass:e,defaults:t.extend({},e._modelClassMeta&&e._modelClassMeta.defaults||{},f),propertyInitializers:t.extend({},e._modelClassMeta&&e._modelClassMeta.propertyInitializers||{},v),collectionExtensions:{}},e._modelClassMeta&&t.isObject(e._modelClassMeta.collectionExtensions)&&(b.collectionExtensions=t.extend({},b.collectionExtensions,e._modelClassMeta.collectionExtensions)),m&&(b.collectionExtensions=t.extend({},b.collectionExtensions,m)),_._modelClassMeta=_.prototype._modelClassMeta=b,_},extendCollection:function(e,r){return e&&e._modelClassMeta&&r?(e._modelClassMeta.collectionExtensions=t.extend({},e._modelClassMeta.collectionExtensions,r),e):e}},h={resolve:function(e){var t=e.parentModelized,r=e.isCollection,n=e.resourceName,o=t?t.modelClass:i,a={modelClass:null,modelInstanceOptions:{}};if(!l.isLikeUrl(e.resourceName)&&o&&c.isModelClass(o)&&o!==s&&(r&&c.hasCollectionAttr(o,n)||c.hasModelAttr()(o,n))){var u=c.getSpecialAttrMeta(o,n);u&&(a.modelClass=u.modelClass)}if(!a.modelClass){var h=[],f=l.asUrl(n);h.unshift(f);for(var m=t;m&&(m.isCollection||!m.resourceId);){var p=m.modelInstanceOptions.baseUrl;p&&(f=l.combineUrls(p,f),h.unshift(f));var v=m.modelInstanceOptions.urlPrefix;if(!v)break;m=m.parentModelized,!m&&v&&h.unshift(l.combineUrls(v,f))}for(var b=0;b<h.length&&(a.modelClass=d.byBaseUrl[h[b]],!a.modelClass);b++);}a.modelClass||l.isLikeUrl(n)||(d.byModelName[n]&&(a.modelClass=d.byModelName[n]),r&&d.byCollectionName[n]&&(a.modelClass=d.byCollectionName[n])),a.modelClass||(a.modelClass=s),a.modelInstanceOptions.baseUrl=a.modelClass.baseUrl||l.asUrl(n);var g="";if(t){var C=t.modelInstanceOptions.baseUrl;!t.isCollection&&t.resourceId&&(C=l.buildRestfulUrl(C,!1,t.resourceId)),g=l.combineUrls(t.modelInstanceOptions.urlPrefix,C)}return g&&(a.modelInstanceOptions.urlPrefix=l.stripOverlap(g,a.modelInstanceOptions.baseUrl)),t&&(a.parentModelized=t),a}},f=function(e){if(e._modelClassMeta&&e._modelClassMeta.propertyInitializers)for(var t=Object.getOwnPropertyNames(e._modelClassMeta.propertyInitializers),r=0;r<t.length;r++){var i=t[r],s=e._modelClassMeta.propertyInitializers[i];s(e,i)}},m=["$$hashKey","$iid","_modelClassMeta","_collections","_remoteState","_loadingTracker","idAttribute","baseUrl","urlPrefix","$modelErrors","$error","$valid","$invalid","$loading","$selected","$destroyed"];return e.module("angular-modelizer",[]).provider("modelize",function(){var r=this;this.parseModelErrors=function(e){if(!e||!e.fieldErrors||!t.isArray(e.fieldErrors))return null;var r={};return e.fieldErrors.forEach(function(e){var i=e.field,s=e.message;t.isArray(r[i])||(r[i]=[]),r[i].push(s)}),r},this.$get=["$q","$http",function(a,p){var v=function(){if(!(this instanceof v))return new v;var e=this,t=[];this.active=function(){return t.length>0},this.destroy=this.cancel=function(){for(var e=t.length-1;e>=0;e--)t[e].resolve();t.length=0},this.createPromise=function(){var e=a.defer();return t.push(e),e.promise.finally(function(){t.splice(t.indexOf(e),1)}),e},this.addPromise=function(t){if(!t.then)throw new Error("promiseTracker#addPromise expects a promise object!");var r=e.createPromise();return t.then(function(e){return r.resolve(e),e},function(e){return r.reject(e),a.reject(e)}),r}},b={setFuture:function(e,t){return e.$future=t,e}},g=function(e){e=e||{};var r=e.method||"",s=e.url,n=e.data||i,o=!!e.fullResponse,l=a.defer(),d={};return p(t.extend({},e,{method:r.toUpperCase(),url:s,data:n})).then(function(e){d=o?e:e.data,l.resolve(d)},function(e){l.reject(e)}),l.promise=b.setFuture(l.promise,d),l.promise};t.extend(g,{setUrlParams:l.setUrlParams,get:function(e,r){return g(t.extend({},r,{method:"GET",url:e}))},post:function(e,r,i){return g(t.extend({},i,{method:"POST",url:e,data:r}))},put:function(e,r,i){return g(t.extend({},i,{method:"PUT",url:e,data:r}))},patch:function(e,r,i){return g(t.extend({},i,{method:"PATCH",url:e,data:r}))},"delete":function(e,r){return g(t.extend({},r,{method:"DELETE",url:e}))},head:function(e,r){return g(t.extend({},r,{method:"HEAD",url:e}))}});var C,y,_=function(e,r,i,s,n){n=t.clone(n)||{},this.resourceName=e,this.resourceId=r,this.isCollection=i,this.parentModelized=s,this.modelized=h.resolve(this,n),t.extend(this,i?y:C)},x={one:function(e,t,r){return new _(e,t,!1,this.modelized,r)},many:function(e,t){return new _(e,null,!0,this.modelized,t)}},U={get $modelClass(){return this.modelized.modelClass},$new:function(e,r){return e=e||{},!this.isCollection&&this.resourceId&&(e[this.modelized.modelClass.prototype.idAttribute]=this.resourceId),this.modelized.modelClass.$new(e,t.extend({},this.modelized.modelInstanceOptions,r))},$newCollection:function(e,r){return this.modelized.modelClass.$newCollection(e,t.extend({},this.modelized.modelInstanceOptions,r))}};o(_.prototype,x,U),C={get:function(e){return this.$new({},t.extend({},this.modelized.modelInstanceOptions,e)).fetch(e)},save:function(e,r){return this.$new(e,t.extend({},this.modelized.modelInstanceOptions,r)).save(r)},destroy:function(e){return this.$new({},t.extend({},this.modelized.modelInstanceOptions,e)).$destroy(e)}},y={get:function(e,r){return this.modelized.modelClass.get(e,t.extend({},this.modelized.modelInstanceOptions,r))},all:function(e){return this.modelized.modelClass.all(t.extend({},this.modelized.modelInstanceOptions,e))},query:function(e,r){return this.modelized.modelClass.query(e,t.extend({},this.modelized.modelInstanceOptions,r))},create:function(e,r){if(!e&&!t.isObject(e))return a.reject(!1);r=r?t.clone(r):{},e instanceof s||(e=this.modelized.modelClass.$new(e,t.extend({},this.modelized.modelInstanceOptions,r)));var i=e.save(null,r);return b.setFuture(i,e)},destroy:function(e,r){r=r?t.clone(r):{};var i=r.url;return this.modelized.modelClass.baseUrl&&(i=l.setUrlParams(l.appendIdParam(this.modelized.modelClass.baseUrl,e,!0),{})),i||n('URL error: "baseUrl" should be defined on "modelized" model class or "options.url" provided to "destroy" the model'),this.$request.delete(i,r).then(function(){return!0})}};var M=function(e,r){var i=e||{};r=r||{},this.$iid=t.uniqueId("model_"),r.parse&&(i=this.parse(i,r)||{}),i=o({},this._modelClassMeta&&this._modelClassMeta.defaults||{},i),f(this),this.set(i),this._collections={},this._remoteState=null,this.$modelErrors=null,this.baseUrl=r.baseUrl||this.baseUrl||this._class.baseUrl,this.urlPrefix=r.urlPrefix||this.urlPrefix||this._class.urlPrefix,this._loadingTracker=new v,this.initialize.apply(this,arguments),r.initRemoteState&&(this._remoteState=this.serialize())};o(M.prototype,{_class:M,get $valid(){return this.isValid()},get $invalid(){return!this.isValid()},get $loading(){return this._loadingTracker&&this._loadingTracker.active()},idAttribute:"id",initialize:function(){},resourceUrl:function(){return this.baseUrl?!this.idAttribute||this.isNew()?l.setUrlParams(l.combineUrls(this.urlPrefix,this.baseUrl),this):l.setUrlParams(l.combineUrls(this.urlPrefix,l.appendIdParam(this.baseUrl,this.idAttribute)),this):null},set:function(e,t){return e=e||{},t=t||{},this._validate(e,t),o(this,e),this},clear:function(e){var r=this.getAttributes(t.extend({},e,{includeComputed:!1}));for(var s in r)this[s]=i},fetch:function(e){if(this.$destroyed)return b.setFuture(a.reject(this),this);var r=this,s=this.resourceUrl();e=e?t.clone(e):{},e.parse===i&&(e.parse=!0),s||n('URL error: "baseUrl" should be defined or "options.url" specified to "fetch" the model');var o=this.$request.get(s,e).then(function(t){var i=e.fullResponse?t.data:t,s=e.parse?r.parse(i,e):i;return r.set(s,e),r._remoteState=r.serialize(e),r},function(e){a.reject(e)});return this._loadingTracker&&this._loadingTracker.addPromise(o),b.setFuture(o,this)},save:function(e){if(this.$destroyed)return b.setFuture(a.reject(this),this);e=t.extend({validate:!0},e),e.parse===i&&(e.parse=!0),e.validate!==!1&&(e.validate=!0);var r,s=this,o=this.isNew()?"post":e.patch?"patch":"put";if(e.url)r=e.url;else switch(o){case"post":r=this.baseUrl?l.combineUrls(this.urlPrefix,this.baseUrl):null,r||n('URL error: "baseUrl" should be defined or "options.url" specified to "save:create"');break;case"patch":case"put":r=this.resourceUrl(),r||n('URL error: "baseUrl" should be defined or "options.url" specified to "save:update"')}var d=t.extend({method:o,url:r},e);d.data="patch"===o?this.changedAttributes():this.getAttributes({includeComputed:!1});var u=this.$request(d).then(function(t){var r=s.parse(t,e);return s.set(r),s._remoteState=s.serialize(e),s}).catch(function(e){return console.log(e),422===e.status&&e.data&&s.parseModelErrors&&(s.clearModelErrors(),s.addModelErrors(s.parseModelErrors(e.data))),a.reject(e)});return this._loadingTracker&&this._loadingTracker.addPromise(u),b.setFuture(u,this)},destroy:function(e){if(this.$destroyed)return b.setFuture(a.reject(this),this);e=e?t.clone(e):{};var r=this,i=function(){if(r._collections)for(var e in r._collections)r._collections[e].remove(r),delete r._collections[e];r._collections=null};if(this.isNew())return e.keepInCollections||i(),a.when(!1);e.wait||e.keepInCollections||i();var s=e.url||this.resourceUrl();s||n('URL error: "baseUrl" should be defined or "options.url" specified to "destroy" the model');var o=this.$request.delete(s,e).then(function(){return e.wait&&!e.keepInCollections&&i(),r.$destroyed=!0,r});return this._loadingTracker&&this._loadingTracker.addPromise(o),b.setFuture(o,this)},getAttributes:function(e){var r=this,i={},s=t.difference(Object.getOwnPropertyNames(r),m);e=e||{},e.includeComputed!==!1&&(e.includeComputed=!0);for(var n=0;n<s.length;n++){var o=Object.getOwnPropertyDescriptor(r,s[n]);o&&(o.get&&!o.set&&!e.includeComputed||o.set&&!o.get)||(i[s[n]]=r[s[n]])}return i},serialize:function(e){var t=this.getAttributes(e);for(var r in t){var i=t[r];i&&(i instanceof M||i.$isCollection)&&i.serialize&&(t[r]=i.serialize(e))}return t},toJSON:function(t){return e.toJson(this.serialize(t))},parse:function(e){return e},parseModelErrors:function(e,t){return r.parseModelErrors(e,t)},clone:function(e){return new this.constructor(this.getAttributes(t.extend({},e,{includeComputed:!1})))},diff:function(e){var r={};for(var i in e){var s=e[i];t.isEqual(this[i],s)||(r[i]={currentValue:this[i],comparedValue:s})}return r},changedAttributes:function(){var e={};if(this._remoteState){var t=this.diff(this._remoteState);for(var r in t)e[r]=t[r].currentValue}return e},isNew:function(){return!this[this.idAttribute]},isValid:function(e){return this._validate({},t.extend(e||{},{validate:!0}))&&!this.$modelErrors},_validate:function(e,r){return r.validate&&this.validate?(e=t.extend({},this.getAttributes(r),e),this.validationErrors=this.validate(e,r)||null,this.validationErrors?!1:!0):!0},addModelError:function(e,r){if(e&&r&&(t.isString(r)||t.isArray(r))){var i=t.isArray(r)?r:[r];this.$modelErrors||(this.$modelErrors={}),this.$modelErrors[e]&&t.isArray(this.$modelErrors[e])?this.$modelErrors.concat(i):this.$modelErrors[e]=i}},clearModelError:function(e,r){r=r||{},e&&this.$modelErrors[e]&&(r.firstOnly&&t.isArray(this.$modelErrors[e])&&this.$modelErrors[e].length>1?this.$modelErrors[e].shift():delete this.$modelErrors[e])},addModelErrors:function(e){if(e)for(var t in e)this.$modelErrors||(this.$modelErrors={}),this.$modelErrors[t]=e[t]},clearModelErrors:function(){this.$modelErrors=null}});var $={$request:g,get $loading(){return this._loadingTracker&&this._loadingTracker.active()},initialize:function(){},fetch:function(e){var r=this;e=e?t.clone(e):{},e.parse===i&&(e.parse=!0);var s=!!e.fullResponse,n=!!e.rawData,o=e.url;!o&&this.modelClass.baseUrl&&(o=l.combineUrls(this.modelClass.urlPrefix,this.modelClass.baseUrl));var a=this.$request.get(o,e).then(function(t){var i=s?t.data:t,o=e.reset?"reset":"set";return r[o](i,e),n?i:r});return this._loadingTracker&&this._loadingTracker.addPromise(a),b.setFuture(a,this)},get:function(e){if(!e)return i;var t=this._modelId(e);return this._idsIndex[e]||this._idsIndex[t]||this._idsIndex[e.$iid]||i},where:function(e,r){if(t.isEmpty(e))return r?i:[];var s=r?"find":"filter";return t[s](this.models,function(t){for(var r in e)if(e[r]!==t[r])return!1;return!0})},any:function(e){return e?this.where(e).length>0:this.models.length>0},filter:function(e){return t.filter(this.models,e)},create:function(e,r){if(r=r?t.clone(r):{},r.initRemoteState=!0,!(e=this._prepareModel(e,r)))return a.reject(!1);r.wait||this.add(e,r);var i=this,s=e.save(null,r);return s.then(function(){r.wait&&i.add(e,r)}),b.setFuture(s,this)},add:function(e,r){return this.set(e,t.extend({merge:!1},r,{add:!0,remove:!1}))},remove:function(e,r){var i=!t.isArray(e);r=r||{},e=i?[e]:t.clone(e);for(var s=0,n=e.length;n>s;s++){var o=e[s]=this.get(e[s]);if(o){var l=this._modelId(o);null!==l&&delete this._idsIndex[l],delete this._idsIndex[o.$iid];var a=t.indexOf(this.models,o);this.models.splice(a,1),this._removeModelReference(o,r)}}return i?e[0]:e},push:function(e,r){return this.add(e,t.extend({at:this.length},r))},pop:function(e){var t=this.models[this.length-1];return this.remove(t,e),t},unshift:function(e,r){return this.add(e,t.extend({at:0},r))},shift:function(e){var t=this.models[0];return this.remove(t,e),t},slice:function(){return Array.prototype.slice.apply(this.models,arguments)},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a collection without a comparator");return e=e||{},t.isString(this.comparator)||1===this.comparator.length?this.models=t.sortBy(this.models,this.comparator,this):this.models.sort.call(this,this.comparator),this},set:function(e,r){if(r=t.defaults({},r,{add:!0,remove:!0,merge:!0}),r.parse&&(e=this.parse(e,r)),r.initRemoteState!==!1&&(r.initRemoteState=!0),!t.isArray(e)&&!t.isObject(e))return e;var i=!t.isArray(e);e=i?e?[e]:[]:e.slice();var s,n,o,l,a,d,u,c,h=r.add,f=r.merge,m=r.remove,p=r.at,v=[],b=[],g={},C=this.comparator&&r.sort!==!1,y=t.isString(this.comparator)?this.comparator:null,_=!C&&h&&m?[]:!1;for(u=0,c=e.length;c>u;u++)if(n=e[u],t.isObject(n)){if(a=this.get(n))m&&(g[a.$iid]=!0),f&&n!==a&&(n=this._isModel(n)?n.getAttributes():n,r.parse&&(n=a.parse(n,r)),a.set(n,r),C&&!s&&(d=a.diff(n),d&&d[y]&&(s=!0))),e[u]=a;else if(h){if(o=e[u]=this._prepareModel(n,r),!o)continue;v.push(o),this._addModelReference(o,r)}o=a||o,o&&(l=this._modelId(o),!_||!o.isNew()&&g[l]||_.push(o),g[l]=!0)}if(m){for(u=0,c=this.models.length;c>u;u++)g[(o=this.models[u]).$iid]||b.push(o);b.length&&this.remove(b,r)}if(v.length||_&&_.length)if(C&&(s=!0),null!==p)for(u=0,c=v.length;c>u;u++)this.models.splice(p+u,0,v[u]);else{_&&(this.models.length=0);var x=_||v;for(u=0,c=x.length;c>u;u++)this.models.push(x[u])}return s&&this.sort(),i?e[0]:e},reset:function(e,t){t=t||{};for(var r=0,i=this.models.length;i>r;r++)this._removeModelReference(this.models[r],t);return this._reset(),e&&e.length&&this.add(e,t),this},_reset:function(){this.models.length=0,this._idsIndex={}},_prepareModel:function(e,t){if(this._isModel(e))return e;var r=new this.modelClass(e,t);return r},_isModel:function(e){return e instanceof M},_modelId:function(e){return e[this.modelClass.prototype.idAttribute||"id"]},_addModelReference:function(e){if(this._isModel(e)&&e.$iid){this._idsIndex[e.$iid]=e;var t=this._modelId(e);t&&(this._idsIndex[t]=e),e._collections=e._collections||{},e._collections[this.$iid]=this}},_removeModelReference:function(e){if(this._isModel(e)){delete this._idsIndex[e.$iid];var t=this._modelId(e);t&&delete this._idsIndex[t],e._collections&&e._collections[this.$iid]&&delete e._collections[this.$iid]}},serialize:function(e){return t.map(this.models,function(t){return t.serialize(e)})},toJSON:function(t){return e.toJson(this.serialize(t))},parse:function(e){return e},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})}},z=function(e,r){r=r||{};var n=r.modelClass||s,l=[];return o(l,$),n._modelClassMeta&&t.isObject(n._modelClassMeta.collectionExtensions)&&t.extend(l,n._modelClassMeta.collectionExtensions),l.$iid=t.uniqueId("collection_"),l.modelClass=n,l.baseUrl=t.extend({},l.modelClass.baseUrl,r.baseUrl),l.$isCollection=!0,l._loadingTracker=new v,r.comparator!==i&&(l.comparator=r.comparator),l.models=l,l._reset(),l.initialize.apply(l,arguments),e&&l.reset(e,r),l};t.extend(M,{extend:function(e,r){t.isObject(e)&&!t.isArray(e)&&(r=e,e=null);var i=c.extendModelClass(this,r,e);return d.addModelClass(i),i},extendCollection:function(e){return c.extendCollection(this,e)},$new:function(e,r){return r=r?t.clone(r):{},new this(e,r)},$newCollection:function(e,r){return r=r?t.clone(r):{},r=t.extend({},{modelClass:this},r),z(e,r)},get:function(e,t){t=t||{};var r=this,i=t.url;if(!i){var s=t.baseUrl||this.baseUrl,o=t.urlPrefix||this.urlPrefix;s&&(i=l.combineUrls(o,l.appendIdParam(s,e,!0)))}i||n('URL error: "baseUrl" should be defined or "options.url" specified to "get" a resource');var a=t.rawData?{}:r.$new({},t),d=this.$request.get(i,t).then(function(e){return t.rawData?a=e:a.set(e,t),a});return b.setFuture(d,a)},query:function(e,t){t=t||{},t.params=e||{};var r=this,i=t.url||l.combineUrls(t.urlPrefix,t.baseUrl)||l.combineUrls(this.urlPrefix,this.baseUrl);i||n('URL error: "baseUrl" should be defined or "options.url" specified to "query" a resource');var s=t.rawData?[]:r.$newCollection([],t),o=this.$request.get(i,t).then(function(e){return t.rawData?s=e:s.reset(e,t),s});return b.setFuture(o,s)},all:function(e){return this.query(null,e)}}),s=M,M.$request=M.prototype.$request=g;var I=function(e,t){return x.many(e,t)};return o(I,x),I.attr=u,I.Model=s,I.$request=g,I.internal={modelizeMetaResolver:h,modelClassCache:d},I.defineModel=function(e,t){return s.extend(e,t)},I}]}).directive("mzModelError",function(){return{restrict:"A",require:["?ngModel"],link:function(t,r,i,s){var n=s[0];n&&i.mzModelError&&t.$watch(i.mzModelError,function(t){var r=t||e.isArray(t)&&t.length>0;n.$setValidity("modelError",!r)})}}})});