"use strict";!function(e,t){"function"==typeof define&&define.amd?define(["angular"],function(e){return t(e,document)}):t(angular,document)}(window,function(e,t,r){var n=function(e){throw new Error(e)},i=0,s={};s.isString=function(t){return e.isString(t)},s.isNumber=function(t){return e.isNumber(t)},s.isObject=function(e){var t=typeof e;return"function"===t||e&&"object"===t||!1},s.isArray=function(t){return e.isArray(t)},s.isArguments=function(e){return"[object Arguments]"===Object.prototype.toString.call(e)},s.isFunction=function(t){return e.isFunction(t)},s.isEqual=function(t,r){return e.equals(t,r)},s.isEmpty=function(e){if(null===e||void 0===e)return!0;if(s.isArray(e)||s.isString(e)||s.isArguments(e))return 0===e.length;for(var t in e)if(s.has(e,t))return!1;return!0},s.extend=function(e){if(!s.isObject(e))return e;for(var t,r,n=1,i=arguments.length;i>n;n++){t=arguments[n];for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},s.has=function(e,t){return e&&Object.prototype.hasOwnProperty.call(e,t)},s.indexOf=function(e,t){if(!e||!e.length)return-1;for(var r=0;r<e.length;r++)if(e[r]===t)return r;return-1},s.keys=function(e){if(!s.isObject(e))return[];if(Object.keys)return Object.keys(e);var t=[];for(var r in e)s.has(e,r)&&t.push(r);return t},s.values=function(e){for(var t=s.keys(e),r=t.length,n=new Array(r),i=0;r>i;i++)n[i]=e[t[i]];return n},s.pairs=function(e){for(var t=s.keys(e),r=t.length,n=new Array(r),i=0;r>i;i++)n[i]=[t[i],e[t[i]]];return n},s.contains=function(e,t){return e?(e.length!==+e.length&&(e=s.values(e)),s.indexOf(e,t)>=0):!1},s.flatten=function(e,t,r,n){if(r=!!r,n=n||[],t&&s.isArray(e)&&e.length>0){for(var i=!0,o=0;o<e.length;o++)if(!s.isArray(e[o])){i=!1;break}if(i)return Array.prototype.concat.apply(n,e)}for(var l=0,a=e.length;a>l;l++){var u=e[l];s.isArray(u)||s.isArguments(u)?t?Array.prototype.push.apply(n,u):s.flatten(u,t,r,n):r||n.push(u)}return n},s.difference=function(e){var t=s.flatten(Array.prototype.slice.call(arguments,1),!0,!0,[]);return s.filter(e,function(e){return!s.contains(t,e)})},s.without=function(e){return s.difference(e,Array.prototype.slice.call(arguments,1))},s.map=function(e,t){return Array.prototype.map.call(e,t)},s.iteratee=function(t){if(!t)return e.identity;if(s.isFunction(t)){var r=t;return function(e,t,n){return r.call(null,e,t,n)}}if(s.isObject(t))return s.matches(t);var n=function(e){return function(t){return t[e]}};return n(t)},s.matches=function(e){var t=s.pairs(e),r=t.length;return function(e){if(!e)return!r;e=new Object(e);for(var n=0;r>n;n++){var i=t[n],s=i[0];if(i[1]!==e[s]||!(s in e))return!1}return!0}},s.any=function(e,t){if(!e)return!1;t=s.iteratee(t);var r,n,i=e.length!==+e.length&&s.keys(e),o=(i||e).length;for(r=0;o>r;r++)if(n=i?i[r]:r,t(e[n],n,e))return!0;return!1},s.find=function(e,t){var r;return t=s.iteratee(t),s.any(e,function(e,n,i){return t(e,n,i)?(r=e,!0):void 0}),r},s.filter=function(t,r){var n=[];return t?(r=s.iteratee(r),e.forEach(t,function(e,t,i){r(e,t,i)&&n.push(e)}),n):n},s.clone=function(e){return s.isObject(e)?s.isArray(e)?e.slice():s.extend({},e):e},s.uniqueId=function(e){var t=++i;return String(null===e?"":e)+t};var o,l=function(e){if(!e)return{};if(!s.isObject(e))return e;for(var t=Array.prototype.slice.call(arguments,1),r=s.keys(e),n={},i=0;i<r.length;i++){var o=r[i];o in e&&!s.contains(t,o)&&(n[o]=e[o])}return n},a=function(e,t){if(!e)return e;if(t&&s.isFunction(t)||(t=s.extend),s.isArray(e)){for(var r=s.clone(e),n=0;n<r.length;n++)r[n]=a(r[n]);return r}return s.isFunction(e)?e:s.isObject(e)?t({},e):e},u=function(t){return t=t||{},e.forEach(arguments,function(e){if(e!==t&&s.isObject(e))for(var n in e){var i=Object.getOwnPropertyDescriptor(e,n);if(i&&(i.get||i.set)){var o=i.get||r,l=i.set||r;Object.defineProperty(t,n,{get:o,set:l,enumerable:!0,configurable:!0})}else t[n]=a(e[n],u)}}),t},c=function(e){if(!e||!s.isObject(e))return!0;for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},d={isLikeUrl:function(e){return s.contains(e,"/")||s.contains(e,"-")},asUrl:function(e){return e?d.stripDoubleSlashes("/"+e):""},combineUrls:function(){var e=s.filter(Array.prototype.slice.call(arguments),function(e){return!!e});return d.asUrl(e.join("/"))},stripDoubleSlashes:function(e){return e?e.replace(/(\/)\/+/g,"$1"):""},trimSlashes:function(e){return e.replace(/^\/|\/$/g,"")},stripOverlap:function(e,t){if(!e||!t)return e;var r=d.trimSlashes(e).split("/"),n=d.trimSlashes(t).split("/"),i=[],s=!1;for(r.length>n.length?r.splice(0,r.length-n.length):n.length=r.length;r.length;){for(var o=0;o<r.length;o++){if(r[o]!==n[o]){i=[],s=!1;break}s=!0,i.push(r[o])}if(s)break;r.shift(),n.pop()}var l=d.asUrl(i.join("/"));return d.asUrl(l.length?e.substring(0,e.indexOf(l)):e)},setUrlParams:function(e,t,i){return e?e.replace(/\:\_*[A-Za-z]+/g,function(s){return s=s.replace(/\:*/,""),t[s]!==r||i||n('No parameter "'+s+'" is available for URL '+e),t[s]}):e},appendIdParam:function(e,t,r){return e?e.replace(/([^\/])$/,"$1/")+(r?t:":"+(t||"id")):e},buildRestfulUrl:function(e,t,r){return t?d.asUrl(e):d.asUrl(d.appendIdParam(e,r,!0))}},f={capitalize:function(e){return e?e.charAt(0).toUpperCase()+e.slice(1):e},pluralize:function(e){return e?"s"===e.charAt(e.length)?e+"es":e+"s":e},toDashCase:function(e){return e?e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase():e}},h={byModelName:{},byCollectionName:{},byBaseUrl:{},addModelClass:function(e){if(e&&e._modelClassMeta){var t=e._modelClassMeta;t.modelName&&(this.byModelName[t.modelName]=e),t.collectionName&&(this.byCollectionName[t.collectionName]=e),e.baseUrl&&"/"!==e&&!this.byBaseUrl[e.baseUrl]&&(this.byBaseUrl[e.baseUrl]=e)}}},m={model:function(e){var t=e.modelClass,r=l(e,"modelClass"),n=!t||s.isString(t),i=function(i,l){var a,u=null;t&&n?a=h.byModelName[t]||h.byModelName[l]:t&&(a=t),a||(a=o),e.modelClass=a,Object.defineProperty(i,l,{enumerable:!0,configurable:!0,get:function(){return u},set:function(e){return e?(e instanceof a?u=e:s.isObject(e)&&(u=a.$new(e,r)),void 0):(u=e,void 0)}})};return e.attrType="model",i.attrDefinition=e,i.isPropertyInitializer=!0,i},collection:function(e){var t=e.modelClass,r=l(e,"modelClass"),n=!t||s.isString(t),i=function(i,s){var l,a=null;t&&n?l=h.byModelName[t]||h.byModelName[s]:t&&(l=t),l||(l=o),e.modelClass=l,Object.defineProperty(i,s,{enumerable:!0,configurable:!0,get:function(){return a||(a=l.$newCollection(null,r)),a},set:function(e){a?a.reset(e):a=l.$newCollection(e,r)}})};return e.attrType="collection",i.attrDefinition=e,i.isPropertyInitializer=!0,i},date:function(e){var t=function(e,t){var r=null;Object.defineProperty(e,t,{enumerable:!0,configurable:!0,get:function(){return r||(r=new Date(0)),r},set:function(e){e instanceof Date?r=e:(s.isString(e)||s.isNumber(e))&&(r=Date(e))}})};return e.attrType="date",t.attrDefinition=e,t.isPropertyInitializer=!0,t},computed:function(e){var t=function(t,r){Object.defineProperty(t,r,{enumerable:!0,configurable:!0,get:function(){return e(this)}})};return t.attrDefinition={attrType:"computed"},t.isPropertyInitializer=!0,t}},p={isModelClass:function(e){return e.prototype instanceof o},isDefaultModelClass:function(e){return e===o},hasSpecialAttr:function(e,t){return e&&e._modelClassMeta&&e._modelClassMeta.propertyInitializers?!!e._modelClassMeta.propertyInitializers[t]:!1},hasCollectionAttr:function(e,t){var r=this.getSpecialAttrMeta(e,t);return r&&"collection"===r.attrType},hasModelAttr:function(e,t){var r=this.getSpecialAttrMeta(e,t);return r&&"model"===r.attrType},getSpecialAttrMeta:function(e,t){return this.hasSpecialAttr(e,t)?e._modelClassMeta.propertyInitializers[t].attrDefinition:null},extendClass:function(e,t,r,n){var i;return n=n||"Extended",i=t&&s.has(t,"constructor")?t.constructor:new Function("p","return function "+n+"(){return p.apply(this,arguments);}")(e),u(i,e,r),i.prototype=Object.create(e.prototype),t&&u(i.prototype,t),i.superclass=i.prototype._superclass=e,i.__super__=i.prototype._super=e.prototype,i.prototype._class=i,i},extendModelClass:function(e,t,i){t=t||{};var o,a,c,m=l(t,"static","collection","baseUrl","urlPrefix"),p={},v=s.isObject(t.collection)?t.collection:null,b=s.isObject(t.static)?t.static:{},g={},y={};s.isArray(i)&&i.length>0?(o=i[0],a=i[1]):s.isString(i)&&(o=i),s.isString(o)||n("You have to provide the model name to define a new model"),h.byModelName[o]&&n('The model name should be unique. It seems that you already have the model with name "'+o+'"'),o&&!a&&(a=f.pluralize(o)),h.byCollectionName[a]&&n('The collection name should be unique. It seems that you already have the model with collection name "'+a+'"'),c=o?f.capitalize(o):"ExtendedModel";for(var C in m)if(s.isFunction(m[C]))m[C].isPropertyInitializer&&(g[C]=m[C],delete m[C]);else{var _=Object.getOwnPropertyDescriptor(m,C);if(_.get||_.set)continue;p[C]=m[C],delete m[C]}var x=u({},m);b.urlPrefix=t.urlPrefix||r,b.baseUrl=t.baseUrl||r,b.baseUrl||(b.baseUrl=d.asUrl(f.toDashCase(a)));var U=this.extendClass(e,x,b,c);return y={modelDefinition:t,modelName:o,collectionName:a,superclass:e,defaults:s.extend({},e._modelClassMeta&&e._modelClassMeta.defaults||{},p),propertyInitializers:s.extend({},e._modelClassMeta&&e._modelClassMeta.propertyInitializers||{},g),collectionExtensions:{}},e._modelClassMeta&&s.isObject(e._modelClassMeta.collectionExtensions)&&(y.collectionExtensions=s.extend({},y.collectionExtensions,e._modelClassMeta.collectionExtensions)),v&&(y.collectionExtensions=s.extend({},y.collectionExtensions,v)),U._modelClassMeta=U.prototype._modelClassMeta=y,U},extendCollection:function(e,t){return e&&e._modelClassMeta&&t?(e._modelClassMeta.collectionExtensions=s.extend({},e._modelClassMeta.collectionExtensions,t),e):e}},v={resolve:function(e){var t=e.parentModelized,n=e.isCollection,i=e.resourceName,s=t?t.modelClass:r,l={modelClass:null,modelInstanceOptions:{}};if(!d.isLikeUrl(e.resourceName)&&s&&p.isModelClass(s)&&s!==o&&(n&&p.hasCollectionAttr(s,i)||p.hasModelAttr()(s,i))){var a=p.getSpecialAttrMeta(s,i);a&&(l.modelClass=a.modelClass)}if(!l.modelClass){var u=[],c=d.asUrl(i);u.unshift(c);for(var f=t;f&&(f.isCollection||!f.resourceId);){var m=f.modelInstanceOptions.baseUrl;m&&(c=d.combineUrls(m,c),u.unshift(c));var v=f.modelInstanceOptions.urlPrefix;if(!v)break;f=f.parentModelized,!f&&v&&u.unshift(d.combineUrls(v,c))}for(var b=0;b<u.length&&(l.modelClass=h.byBaseUrl[u[b]],!l.modelClass);b++);}l.modelClass||d.isLikeUrl(i)||(h.byModelName[i]&&(l.modelClass=h.byModelName[i]),n&&h.byCollectionName[i]&&(l.modelClass=h.byCollectionName[i])),l.modelClass||(l.modelClass=o),l.modelInstanceOptions.baseUrl=l.modelClass.baseUrl||d.asUrl(i);var g="";if(t){var y=t.modelInstanceOptions.baseUrl;!t.isCollection&&t.resourceId&&(y=d.buildRestfulUrl(y,!1,t.resourceId)),g=d.combineUrls(t.modelInstanceOptions.urlPrefix,y)}return g&&(l.modelInstanceOptions.urlPrefix=d.stripOverlap(g,l.modelInstanceOptions.baseUrl)),t&&(l.parentModelized=t),l}},b=function(e){if(e._modelClassMeta&&e._modelClassMeta.propertyInitializers)for(var t=Object.getOwnPropertyNames(e._modelClassMeta.propertyInitializers),r=0;r<t.length;r++){var n=t[r],i=e._modelClassMeta.propertyInitializers[n];i(e,n)}},g=["$$hashKey","$iid","_modelClassMeta","_collections","_remoteState","_loadingTracker","idAttribute","baseUrl","urlPrefix","$modelErrors","$error","$valid","$invalid","$loading","$selected","$destroyed"];return e.module("angular-modelizer",[]).provider("modelize",function(){var t=this;this.parseModelErrors=function(e){if(!e||!e.fieldErrors||!s.isArray(e.fieldErrors))return null;var t={};return e.fieldErrors.forEach(function(e){var r=e.field,n=e.message;s.isArray(t[r])||(t[r]=[]),t[r].push(n)}),t},this.$get=["$q","$http",function(i,l){var a=function(){if(!(this instanceof a))return new a;var e=this,t=[];this.active=function(){return t.length>0},this.destroy=this.cancel=function(){for(var e=t.length-1;e>=0;e--)t[e].resolve();t.length=0},this.createPromise=function(){var e=i.defer();return t.push(e),e.promise.finally(function(){t.splice(t.indexOf(e),1)}),e},this.addPromise=function(t){if(!t.then)throw new Error("promiseTracker#addPromise expects a promise object!");var r=e.createPromise();return t.then(function(e){return r.resolve(e),e},function(e){return r.reject(e),i.reject(e)}),r}},f={setFuture:function(e,t){return e.$future=t,e}},y=function(e){e=e||{};var t=e.method||"",n=e.url,o=e.data||r,a=!!e.fullResponse,u=i.defer(),c={};return l(s.extend({},e,{method:t.toUpperCase(),url:n,data:o})).then(function(e){c=a?e:e.data,u.resolve(c)},function(e){u.reject(e)}),u.promise=f.setFuture(u.promise,c),u.promise};s.extend(y,{setUrlParams:d.setUrlParams,get:function(e,t){return y(s.extend({},t,{method:"GET",url:e}))},post:function(e,t,r){return y(s.extend({},r,{method:"POST",url:e,data:t}))},put:function(e,t,r){return y(s.extend({},r,{method:"PUT",url:e,data:t}))},patch:function(e,t,r){return y(s.extend({},r,{method:"PATCH",url:e,data:t}))},"delete":function(e,t){return y(s.extend({},t,{method:"DELETE",url:e}))},head:function(e,t){return y(s.extend({},t,{method:"HEAD",url:e}))}});var C,_,x=function(e,t,r,n,i){i=s.clone(i)||{},this.resourceName=e,this.resourceId=t,this.isCollection=r,this.parentModelized=n,this.modelized=v.resolve(this,i),s.extend(this,r?_:C)},U={one:function(e,t,r){return new x(e,t,!1,this.modelized,r)},many:function(e,t){return new x(e,null,!0,this.modelized,t)}},M={get $modelClass(){return this.modelized.modelClass},$new:function(e,t){return e=e||{},!this.isCollection&&this.resourceId&&(e[this.modelized.modelClass.prototype.idAttribute]=this.resourceId),this.modelized.modelClass.$new(e,s.extend({},this.modelized.modelInstanceOptions,t))},$newCollection:function(e,t){return this.modelized.modelClass.$newCollection(e,s.extend({},this.modelized.modelInstanceOptions,t))}};u(x.prototype,U,M),C={get:function(e){return this.$new({},s.extend({},this.modelized.modelInstanceOptions,e)).fetch(e)},save:function(e,t){return this.$new(e,s.extend({},this.modelized.modelInstanceOptions,t)).save(t)},destroy:function(e){return this.$new({},s.extend({},this.modelized.modelInstanceOptions,e)).$destroy(e)}},_={get:function(e,t){return this.modelized.modelClass.get(e,s.extend({},this.modelized.modelInstanceOptions,t))},all:function(e){return this.modelized.modelClass.all(s.extend({},this.modelized.modelInstanceOptions,e))},query:function(e,t){return this.modelized.modelClass.query(e,s.extend({},this.modelized.modelInstanceOptions,t))},create:function(e,t){if(!e&&!s.isObject(e))return i.reject(!1);t=t?s.clone(t):{},e instanceof o||(e=this.modelized.modelClass.$new(e,s.extend({},this.modelized.modelInstanceOptions,t)));var r=e.save(null,t);return f.setFuture(r,e)},destroy:function(e,t){t=t?s.clone(t):{};var r=t.url;return this.modelized.modelClass.baseUrl&&(r=d.setUrlParams(d.appendIdParam(this.modelized.modelClass.baseUrl,e,!0),{})),r||n('URL error: "baseUrl" should be defined on "modelized" model class or "options.url" provided to "destroy" the model'),this.$request.delete(r,t).then(function(){return!0})}};var $=function(e,t){var r=e||{};t=t?s.clone(t):{},this._initOptions=t,this.$iid=s.uniqueId("model_"),t.parse&&(r=this.parse(r,t)||{}),r=u({},this._modelClassMeta&&this._modelClassMeta.defaults||{},r),b(this),this.set(r),this._collections={},this._remoteState=null,this.$modelErrors=null,this.baseUrl=t.baseUrl||this.baseUrl||this._class.baseUrl,this.urlPrefix=t.urlPrefix||this.urlPrefix||this._class.urlPrefix,this._loadingTracker=new a,this.initialize.apply(this,arguments),t.updateRemoteState&&(this._remoteState=this.serialize())};u($.prototype,{_class:$,get $valid(){return this.isValid()},get $invalid(){return!this.isValid()},get $loading(){return this._loadingTracker&&this._loadingTracker.active()},idAttribute:"id",initialize:function(){},resourceUrl:function(){return this.baseUrl?!this.idAttribute||this.isNew()?d.setUrlParams(d.combineUrls(this.urlPrefix,this.baseUrl),this):d.setUrlParams(d.combineUrls(this.urlPrefix,d.appendIdParam(this.baseUrl,this.idAttribute)),this):null},set:function(e,t){return e=e||{},t=t||{},u(this,e),this},clear:function(e){for(var t in this.getAttributes(e))this[t]=r},fetch:function(e){if(this.$destroyed)return f.setFuture(i.reject(this),this);var t=this,o=this.resourceUrl();e=e?s.clone(e):{},e.parse===r&&(e.parse=!0),o||n('URL error: "baseUrl" should be defined or "options.url" specified to "fetch" the model');var l=this.$request.get(o,e).then(function(r){var n=e.fullResponse?r.data:r,i=e.parse?t.parse(n,e):n;return t.set(i,e),t._remoteState=t.serialize(e),t},function(e){i.reject(e)});return this._loadingTracker&&this._loadingTracker.addPromise(l),f.setFuture(l,this)},save:function(e){if(this.$destroyed)return f.setFuture(i.reject(this),this);e=s.extend({},e);var t,r=this,o=this.isNew()?"post":e.patch?"patch":"put";if(e.url)t=e.url;else switch(o){case"post":t=this.baseUrl?d.combineUrls(this.urlPrefix,this.baseUrl):null,t||n('URL error: "baseUrl" should be defined or "options.url" specified to "save:create"');break;case"patch":case"put":t=this.resourceUrl(),t||n('URL error: "baseUrl" should be defined or "options.url" specified to "save:update"')}var l=s.extend({method:o,url:t},e);l.data="patch"===o?this.serialize({changedOnly:!0}):this.serialize(),this.transformOnSave&&s.isFunction(this.transformOnSave)&&(l.data=this.transformOnSave(l.data,e));var a=this.$request(l).then(function(t){if(t&&s.isObject(t)){var n=r.parse(t,e);r.set(n)}return r._remoteState=r.serialize(e),r}).catch(function(e){return 422===e.status&&e.data&&r.parseModelErrors&&(r.clearModelErrors(),r.addModelErrors(r.parseModelErrors(e.data))),i.reject(e)});return this._loadingTracker&&this._loadingTracker.addPromise(a),f.setFuture(a,this)},destroy:function(e){if(this.$destroyed)return f.setFuture(i.reject(this),this);e=e?s.clone(e):{};var t=this,r=function(){if(t._collections)for(var e in t._collections)t._collections[e].remove(t),delete t._collections[e];t._collections=null};if(this.isNew())return e.keepInCollections||r(),i.when(!1);e.wait||e.keepInCollections||r();var o=e.url||this.resourceUrl();o||n('URL error: "baseUrl" should be defined or "options.url" specified to "destroy" the model');var l=this.$request.delete(o,e).then(function(){return e.wait&&!e.keepInCollections&&r(),t.$destroyed=!0,t});return this._loadingTracker&&this._loadingTracker.addPromise(l),f.setFuture(l,this)},getAttributes:function(e){var t=this,r={},n=s.difference(Object.getOwnPropertyNames(t),g);e=e||{};for(var i=0;i<n.length;i++){var o=Object.getOwnPropertyDescriptor(t,n[i]);o&&(o.get&&!o.set&&!e.includeComputed||o.set&&!o.get)||(r[n[i]]=t[n[i]])}return r},serialize:function(e){e=e||{};var t=e.changedOnly?this.getChangedAttributes(e):this.getAttributes(e);for(var r in t){var n=t[r];n&&(n instanceof $||n.$isCollection)&&n.serialize&&(t[r]=n.serialize(e))}return t},toJSON:function(t){return e.toJson(this.serialize(t))},parse:function(e){return e},parseModelErrors:function(e,r){return t.parseModelErrors(e,r)},clone:function(e){return new this.constructor(this.getAttributes(e),s.extend({},this._initOptions,e))},diff:function(e,t){var r={},n=this.getAttributes(t);for(var i in e){var o=e[i],l=n[i]instanceof $,a=n[i]&&n[i].$isCollection,u=!1;if(l){var d=n[i].diff(o);c(d)||(u=!0)}else if(a)if(o&&o.length===n[i].length){for(var f=n[i].serialize(),h=0;h<f.length;h++)if(!s.isEqual(f[h],o[h])){u=!0;break}}else u=!0;else s.isEqual(n[i],o)||(u=!0);u&&(r[i]={currentValue:n[i],comparedValue:o})}return r},getChangedAttributes:function(){var e={};if(this._remoteState){var t=this.diff(this._remoteState);for(var r in t)e[r]=t[r].currentValue}return e},isNew:function(){return!this[this.idAttribute]},isValid:function(){return!this.$modelErrors},addModelError:function(e,t){if(e&&t&&(s.isString(t)||s.isArray(t))){var r=s.isArray(t)?t:[t];this.$modelErrors||(this.$modelErrors={}),this.$modelErrors[e]&&s.isArray(this.$modelErrors[e])?this.$modelErrors.concat(r):this.$modelErrors[e]=r}},clearModelError:function(e,t){t=t||{},e&&this.$modelErrors[e]&&(t.firstOnly&&s.isArray(this.$modelErrors[e])&&this.$modelErrors[e].length>1?this.$modelErrors[e].shift():delete this.$modelErrors[e])},addModelErrors:function(e){if(e)for(var t in e)this.$modelErrors||(this.$modelErrors={}),this.$modelErrors[t]=e[t]},clearModelErrors:function(){this.$modelErrors=null}});var O={$request:y,get $loading(){return this._loadingTracker&&this._loadingTracker.active()},initialize:function(){},fetch:function(e){var t=this;e=e?s.clone(e):{},e.parse===r&&(e.parse=!0);var n=!!e.fullResponse,i=!!e.rawData,o=e.url;!o&&this.modelClass.baseUrl&&(o=d.combineUrls(this.modelClass.urlPrefix,this.modelClass.baseUrl));var l=this.$request.get(o,e).then(function(r){var s=n?r.data:r,o=e.reset?"reset":"set";return t[o](s,e),i?s:t});return this._loadingTracker&&this._loadingTracker.addPromise(l),f.setFuture(l,this)},get:function(e){if(!e)return r;var t=this._modelId(e);return this._idsIndex[e]||this._idsIndex[t]||this._idsIndex[e.$iid]||r},where:function(e,t){if(s.isEmpty(e))return t?r:[];var n=t?"find":"filter";return s[n](this.models,function(t){for(var r in e)if(e[r]!==t[r])return!1;return!0})},any:function(e){return e?this.where(e).length>0:this.models.length>0},filter:function(e){return s.filter(this.models,e)},create:function(e,t){if(t=t?s.clone(t):{},t.updateRemoteState=!0,!(e=this._prepareModel(e,t)))return i.reject(!1);t.wait||this.add(e,t);var r=this,n=e.save(null,t);return n.then(function(){t.wait&&r.add(e,t)}),f.setFuture(n,this)},add:function(e,t){return this.set(e,s.extend({merge:!1},t,{add:!0,remove:!1}))},remove:function(e,t){var r=!s.isArray(e);t=t||{},e=r?[e]:s.clone(e);for(var n=0,i=e.length;i>n;n++){var o=e[n]=this.get(e[n]);if(o){var l=this._modelId(o);null!==l&&delete this._idsIndex[l],delete this._idsIndex[o.$iid];var a=s.indexOf(this.models,o);this.models.splice(a,1),this._removeModelReference(o,t)}}return r?e[0]:e},push:function(e,t){return this.add(e,s.extend({at:this.length},t))},pop:function(e){var t=this.models[this.length-1];return this.remove(t,e),t},unshift:function(e,t){return this.add(e,s.extend({at:0},t))},shift:function(e){var t=this.models[0];return this.remove(t,e),t},slice:function(){return Array.prototype.slice.apply(this.models,arguments)},set:function(e,t){if(t=s.extend({},{add:!0,remove:!0,merge:!0},t),t.parse&&(e=this.parse(e,t)),t.updateRemoteState!==!1&&(t.updateRemoteState=!0),!s.isArray(e)&&!s.isObject(e))return e;var r=!s.isArray(e);e=r?e?[e]:[]:e.slice();var n,i,o,l,a,u,c=t.add,d=t.merge,f=t.remove,h=t.at,m=[],p=[],v={};for(a=0,u=e.length;u>a;a++)if(n=e[a],s.isObject(n)){if(l=this.get(n))f&&(v[l.$iid]=!0),d&&n!==l&&(n=this._isModel(n)?n.getAttributes():n,t.parse&&(n=l.parse(n,t)),l.set(n,t)),e[a]=l;else if(c){if(i=e[a]=this._prepareModel(n,t),!i)continue;m.push(i),this._addModelReference(i,t)}i=l||i,i&&(o=this._modelId(i),v[o]=!0)}if(f){for(a=0,u=this.models.length;u>a;a++)v[(i=this.models[a]).$iid]||p.push(i);p.length&&this.remove(p,t)}if(m.length)for(h||(h=0),a=0,u=m.length;u>a;a++)this.models.splice(h+a,0,m[a]);return r?e[0]:e},reset:function(e,t){t=t||{};for(var r=0,n=this.models.length;n>r;r++)this._removeModelReference(this.models[r],t);return this._reset(),e&&e.length&&this.add(e,t),this},_reset:function(){this.models.length=0,this._idsIndex={}},_prepareModel:function(e,t){if(this._isModel(e))return e;var r=new this.modelClass(e,t);return r},_isModel:function(e){return e instanceof $},_modelId:function(e){return e[this.modelClass.prototype.idAttribute||"id"]},_addModelReference:function(e){if(this._isModel(e)&&e.$iid){this._idsIndex[e.$iid]=e;var t=this._modelId(e);t&&(this._idsIndex[t]=e),e._collections=e._collections||{},e._collections[this.$iid]=this}},_removeModelReference:function(e){if(this._isModel(e)){delete this._idsIndex[e.$iid];var t=this._modelId(e);t&&delete this._idsIndex[t],e._collections&&e._collections[this.$iid]&&delete e._collections[this.$iid]}},serialize:function(e){return s.map(this.models,function(t){return t.serialize(e)})},toJSON:function(t){return e.toJson(this.serialize(t))},parse:function(e){return e},clone:function(){return new this.constructor(this.models,{model:this.model})}},z=function(e,t){t=t||{};var r=t.modelClass||o,n=[];return u(n,O),r._modelClassMeta&&s.isObject(r._modelClassMeta.collectionExtensions)&&s.extend(n,r._modelClassMeta.collectionExtensions),n.$iid=s.uniqueId("collection_"),n.modelClass=r,n.baseUrl=s.extend({},n.modelClass.baseUrl,t.baseUrl),n.$isCollection=!0,n._loadingTracker=new a,n.models=n,n._reset(),n.initialize.apply(n,arguments),e&&n.reset(e,t),n};s.extend($,{extend:function(e,t){s.isObject(e)&&!s.isArray(e)&&(t=e,e=null);var r=p.extendModelClass(this,t,e);return h.addModelClass(r),r},extendCollection:function(e){return p.extendCollection(this,e)},$new:function(e,t){return t=t?s.clone(t):{},new this(e,t)},$newCollection:function(e,t){return t=t?s.clone(t):{},t=s.extend({},{modelClass:this},t),z(e,t)},get:function(e,t){t=t||{};var r=this,i=t.url;if(!i){var s=t.baseUrl||this.baseUrl,o=t.urlPrefix||this.urlPrefix;s&&(i=d.combineUrls(o,d.appendIdParam(s,e,!0)))}i||n('URL error: "baseUrl" should be defined or "options.url" specified to "get" a resource');var l=t.rawData?{}:r.$new({},t),a=this.$request.get(i,t).then(function(e){return t.rawData?l=e:l.set(e,t),l});return f.setFuture(a,l)},query:function(e,t){t=t||{},t.params=e||{};var r=this,i=t.url||d.combineUrls(t.urlPrefix,t.baseUrl)||d.combineUrls(this.urlPrefix,this.baseUrl);i||n('URL error: "baseUrl" should be defined or "options.url" specified to "query" a resource');var s=t.rawData?[]:r.$newCollection([],t),o=this.$request.get(i,t).then(function(e){return t.rawData?s=e:s.reset(e,t),s});return f.setFuture(o,s)},all:function(e){return this.query(null,e)}}),o=$,$.$request=$.prototype.$request=y;var w=function(e,t){return U.many(e,t)};return u(w,U),w.attr=m,w.Model=o,w.$request=y,w.internal={modelizeMetaResolver:v,modelClassCache:h},w.defineModel=function(e,t){return o.extend(e,t)},w}]}).directive("mzModelError",function(){return{restrict:"A",require:["?ngModel"],link:function(t,r,n,i){var s=i[0];s&&n.mzModelError&&t.$watch(n.mzModelError,function(t){var r=t||e.isArray(t)&&t.length>0;s.$setValidity("modelError",!r)})}}})});